<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìµœê·¼ ë©”ì‹œì§€</title>

    <style>
        body {
            background-color: #ffeaf4;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }

        h2 {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 30px;
            font-size: 26px;
            color: #ff3399;
        }

        .match-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 20px 60px 20px;
            gap: 14px;
        }

        .card {
            width: 90%;
            max-width: 550px;
            display: flex;
            align-items: center;
            border: 3px dotted #ffaad4;
            padding: 14px;
            background-color: #fff0f7;
            border-radius: 20px;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.2);
            transition: transform 0.2s ease-in-out;
            cursor: pointer;
            position: relative;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 25px rgba(255, 105, 180, 0.3);
        }

        .profile-img {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #a3baff;
            margin-right: 18px;
        }

        .chat-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .name {
            font-size: 17px;
            font-weight: bold;
            color: #333;
        }

        .sub-info {
            font-size: 13px;
            color: #666;
        }

        .last-message {
            margin-top: 6px;
            font-size: 14px;
            color: #444;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .time {
            margin-top: 6px;
            font-size: 12px;
            color: gray;
            text-align: right;
        }

        .badge2 {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #ff3366;
            color: white;
            border-radius: 14px;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: bold;
            min-width: 26px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(255,105,180,0.4);
            z-index: 10;
        }
        .back-btn {
      position: absolute;
      top: 15px;
      left: 20px;
      background: #ff99c8;
      color: white;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(255, 105, 180, 0.3);
    }
    </style>
</head>
<body>
<div id="header-placeholder"></div>
<h2>ğŸ’¬ ì±„íŒ…ë°©</h2>

<div class="match-container" id="chatList"></div>

<script>
    fetch("../match/header.html")
        .then(res => res.text())
        .then(html => document.getElementById("header-placeholder").innerHTML = html);

    
    // ----------------------------------------------------------------
    // 1) ìµœê·¼ ì±„íŒ… ì‚¬ìš©ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (Chat-Service)
    // ----------------------------------------------------------------
    async function loadRecentChats() {
        try {
            const res = await fetch("/api/chat/chatroom", {
                method: "GET",
                credentials: "include"
            });

            const data = await res.json();
            renderChatList(data);
        } catch (e) {
            console.error("ìµœê·¼ ì±„íŒ… ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", e);
        }
    }

    // ----------------------------------------------------------------
    // 2) í™”ë©´ì— ì¹´ë“œ ë Œë”ë§
    // ----------------------------------------------------------------
    function renderChatList(list) {
        const container = document.getElementById("chatList");
        container.innerHTML = "";

        if (!list || list.length === 0) {
            container.innerHTML = `<p style="color:gray;">ìµœê·¼ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ì€ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        list.forEach(chat => {
            container.insertAdjacentHTML("beforeend", `
                <div class="card" onclick="openChat('${chat.otherId}')">

                    ${chat.unreadCount > 0 ? `<span class="badge2">${chat.unreadCount}</span>` : ""}

                    <img src="${chat.imageUrl}" class="profile-img">

                    <div class="chat-info">
                        <div class="top-row">
                            <div class="name">${chat.username}</div>
                            <div class="sub-info">${chat.age}ì„¸ Â· ${chat.home}</div>
                        </div>

                        <div class="last-message">ğŸ—¨ï¸ ${chat.lastMessage}</div>
                        <div class="time">${chat.lastMessageTime}</div>
                    </div>

                </div>
            `);
        });
    }

    // ----------------------------------------------------------------
    // 3) ì¹´ë“œ í´ë¦­ ì‹œ â†’ chat.htmlë¡œ ì´ë™
    // ----------------------------------------------------------------
    function openChat(targetId) {
        location.href = `chat.html?targetId=${targetId}`;
    }

    // ----------------------------------------------------------------
    // 4) ì‹¤í–‰ ì‹œì‘
    // ----------------------------------------------------------------
    loadRecentChats();
</script>

</body>
</html>
